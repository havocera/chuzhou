(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2271a1ea"],{"316e":function(e,t,r){"use strict";r("3573")},3573:function(e,t,r){},"656f":function(e,t,r){"use strict";r.r(t);var a=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[r("el-breadcrumb",{attrs:{"separator-class":"el-icon-arrow-right"}},[r("el-breadcrumb-item",{attrs:{to:{path:"/"}}},[e._v("首页")]),r("el-breadcrumb-item",[e._v("区块链存证系统")]),r("el-breadcrumb-item",[e._v("产品存证系统")])],1),r("el-card",{staticClass:"box-card"},[r("el-row",{attrs:{gutter:10}},[r("el-col",{attrs:{span:6}},[r("el-input",{staticClass:"input-with-select",attrs:{clearable:"",placeholder:"请输入内容"},on:{clear:e.getproductList},model:{value:e.queryInfo.query,callback:function(t){e.$set(e.queryInfo,"query",t)},expression:"queryInfo.query"}},[r("el-button",{attrs:{slot:"append",icon:"el-icon-search"},on:{click:e.queryMsg},slot:"append"})],1)],1),r("el-col",{attrs:{span:2}},[r("el-button",{attrs:{type:"primary"},on:{click:e.addProductZS}},[e._v("添加产品证书")])],1)],1),r("el-table",{staticStyle:{width:"100%"},attrs:{data:e.productList}},[r("el-table-column",{attrs:{label:"编号",type:"index"}}),r("el-table-column",{attrs:{prop:"qymc",label:"生产企业名称",width:"180"}}),r("el-table-column",{attrs:{prop:"cpmc",label:"产品名称",width:"140"}}),r("el-table-column",{attrs:{prop:"youji_name",label:"证书图片",width:"140"},scopedSlots:e._u([{key:"default",fn:function(e){return[r("img",{attrs:{src:e.row.pic_name,alt:"暂无图片",width:"100px",height:"100px"}})]}}])}),r("el-table-column",{attrs:{prop:"flag",label:"证书类型",width:"80"}}),r("el-table-column",{attrs:{prop:"end_time",label:"证书到期时间",width:"180"}}),r("el-table-column",{attrs:{label:"是否上链",width:"80"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("el-tag",{attrs:{type:"0"===t.row.status?"primary":"success","disable-transitions":""}},[e._v(e._s("0"===t.row.status?"未上链":"已上链")+" ")])]}}])}),r("el-table-column",{attrs:{prop:"hash_code",label:"上链凭证"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("div",{staticClass:"name-wrapper",attrs:{slot:"reference"},slot:"reference"},[r("el-tag",{attrs:{size:"medium"}},[e._v(e._s("0"===t.row.status?"等待上链，暂无凭证":t.row.hash_code))])],1)]}}])}),r("el-table-column",{attrs:{label:"操作",width:"270"},scopedSlots:e._u([{key:"default",fn:function(t){return[0==t.row.status?r("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"删除",placement:"top-end"}},[r("el-button",{attrs:{type:"danger",icon:"el-icon-delete"},on:{click:function(r){return e.removeById(t.row.id,t.row.flag)}}})],1):e._e(),r("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"信息上链",placement:"top-end"}},[r("el-button",{attrs:{type:"success",icon:"el-icon-link"},on:{click:function(r){return e.upChain(t.row.id,t.row.flag)}}})],1)]}}])})],1),r("el-pagination",{attrs:{"current-page":e.queryInfo.current_page,background:"",layout:"prev, pager, next, total",total:e.total,"page-size":e.queryInfo.pageSize},on:{"current-change":e.handleCurrentChange}})],1),r("el-dialog",{attrs:{title:"添加产品证书信息",visible:e.addDialogVisible,width:"40%"},on:{"update:visible":function(t){e.addDialogVisible=t},close:e.addFormClosed}},[r("el-form",{attrs:{"label-position":"left","label-width":"140px",model:e.addFormInfo}},[r("el-form-item",{attrs:{label:"产品名称",prop:"cpbh"}},[r("el-select",{attrs:{placeholder:"请选择产品"},model:{value:e.addFormInfo.cpbh,callback:function(t){e.$set(e.addFormInfo,"cpbh",t)},expression:"addFormInfo.cpbh"}},e._l(e.selectProduct,(function(e){return r("el-option",{key:e.bh,attrs:{label:e.cpmc,value:e.bh}})})),1)],1),r("el-form-item",{attrs:{label:"产品认证类型"}},[r("el-select",{attrs:{placeholder:"请选择上传的存证类型"},model:{value:e.addFormInfo.flag,callback:function(t){e.$set(e.addFormInfo,"flag",t)},expression:"addFormInfo.flag"}},e._l(e.options,(function(e){return r("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),r("el-form-item",{attrs:{label:"三品一标证书上传"}},[r("el-upload",{attrs:{name:"image",action:e.uploadURL,"list-type":"picture-card","on-success":e.successEvent}},[r("i",{staticClass:"el-icon-plus"})])],1),r("el-form-item",{attrs:{label:"颁证日期",prop:"start_time"}},[r("el-date-picker",{attrs:{"value-format":"yyyy-MM-dd",format:"yyyy-MM-dd",type:"date",placeholder:"选择日期"},model:{value:e.addFormInfo.start_time,callback:function(t){e.$set(e.addFormInfo,"start_time",t)},expression:"addFormInfo.start_time"}})],1),r("el-form-item",{attrs:{label:"证书失效日期",prop:"end_time"}},[r("el-date-picker",{attrs:{"value-format":"yyyy-MM-dd",format:"yyyy-MM-dd",type:"date",placeholder:"选择日期"},model:{value:e.addFormInfo.end_time,callback:function(t){e.$set(e.addFormInfo,"end_time",t)},expression:"addFormInfo.end_time"}})],1)],1),r("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{on:{click:function(t){e.addDialogVisible=!1}}},[e._v("取 消")]),r("el-button",{attrs:{type:"primary"},on:{click:e.submitspyb}},[e._v("确 定")])],1)],1)],1)},o=[],n=r("1da1"),s=(r("b0c0"),r("96cf"),{data:function(){return{queryInfo:{query:"",pageSize:5,current_page:1},total:0,productList:[],addDialogVisible:!1,addFormInfo:{cpbh:"",flag:"",pic_name:"",end_time:"",start_time:""},editProductForm:{},editProductFormPicname:"",editDialogVisible:!1,tokenStr:window.sessionStorage.getItem("token"),uploadURL:"",headerObj:{token:window.sessionStorage.getItem("token")},FormRules:{cpmc:[{required:!0,message:"请输入产品名称",trigger:"blur"}]},spybDialogVisible:!1,options:[{value:"1",label:"有机证书"},{value:"2",label:"绿色证书"},{value:"3",label:"地理标识证书"}],uploadForm:{flag:"",license_name:""},selectProduct:[]}},created:function(){this.getproductList()},methods:{getproductList:function(){var e=this;return Object(n["a"])(regeneratorRuntime.mark((function t(){var r,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$http.post("LicenseList");case 2:r=t.sent,a=r.data,e.productList=a.data,console.log(a);case 6:case"end":return t.stop()}}),t)})))()},handleCurrentChange:function(e){this.queryInfo.current_page=e,this.getproductList()},queryMsg:function(){this.getproductList()},addFormClosed:function(){console.log(this.$refs),this.$refs.addFormRef.resetFields(),this.$refs.upload.clearFiles()},addProductZS:function(){var e=this;return Object(n["a"])(regeneratorRuntime.mark((function t(){var r,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.tokenStr=window.sessionStorage.getItem("token"),e.uploadURL="http://ahteaapi.wtycms.cn/Spybupload?token="+e.tokenStr,t.next=4,e.$http.post("SelectProduction",{token:e.tokenStr});case 4:r=t.sent,a=r.data,e.selectProduct=a.data,console.log(a.data),e.addDialogVisible=!0;case 9:case"end":return t.stop()}}),t)})))()},submitspyb:function(){this.$http.post("AddLicenseInfo",this.addFormInfo),this.addDialogVisible=!1},successEvent:function(e,t,r){this.addFormInfo.license_name=e.data.saveName,console.log(e,t.name)},showEditDialog:function(e){var t=this;return Object(n["a"])(regeneratorRuntime.mark((function r(){var a,o;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return console.log(e),r.next=3,t.$http.post("EditProductInfo",{token:t.tokenStr,bh:e});case 3:a=r.sent,o=a.data,console.log(o.data),t.editProductForm=o.data,t.editDialogVisible=!0;case 8:case"end":return r.stop()}}),r)})))()},editProductSubmit:function(){var e=this;return Object(n["a"])(regeneratorRuntime.mark((function t(){var r,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.editDialogVisible=!1,t.next=3,e.$http.post("DoEditProductInfo",{token:e.tokenStr,bh:e.editProductForm.bh,picname:e.editProductForm.picname,qymc:e.editProductForm.qymc,cpmc:e.editProductForm.cpmc,cpgg:e.editProductForm.cpgg,bzq:e.editProductForm.bzq,ms:e.editProductForm.ms});case 3:r=t.sent,a=r.data,e.getproductList(),1==a.code?(e.$message.success("产品信息编辑成功"),e.getproductList()):e.$message.error("产品信息编辑失败");case 7:case"end":return t.stop()}}),t)})))()},removeById:function(e,t){var r=this;return Object(n["a"])(regeneratorRuntime.mark((function a(){var o,n,s;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.next=2,r.$confirm("此操作将删除该条证书, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).catch((function(e){return e}));case 2:if(o=a.sent,"confirm"==o){a.next=5;break}return a.abrupt("return",r.$message.info("取消了删除操作"));case 5:return a.next=7,r.$http.post("DelLicenseInfo",{id:e,flag:t});case 7:n=a.sent,s=n.data,console.log(s),0==s.code?(r.$message.success("删除成功"),r.getproductList()):r.$message.error("删除失败");case 11:case"end":return a.stop()}}),a)})))()},addProductSubmit:function(){var e=this;return Object(n["a"])(regeneratorRuntime.mark((function t(){var r,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.addProductForm.token=e.tokenStr,t.next=3,e.$http.post("AddProductInfo",e.addProductForm);case 3:if(r=t.sent,a=r.data,console.log(a),0===a.code){t.next=8;break}return t.abrupt("return",e.$message.error("添加产品失败"));case 8:e.addDialogVisible=!1,e.$message.success("产品添加成功"),e.getproductList();case 11:case"end":return t.stop()}}),t)})))()},handlePreview:function(){},handleRemove:function(){},upChain:function(e,t){var r=this;this.$confirm("此操作将信息上链，上链后数据无法更改, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){r.$http.post("Setstatus",{id:e,flag:t}),r.$message({type:"success",message:"信息上链成功!"})})).catch((function(){r.$message({type:"info",message:"已取消删除"})}))}}}),i=s,c=(r("316e"),r("2877")),l=Object(c["a"])(i,a,o,!1,null,"fe220a4a",null);t["default"]=l.exports}}]);
//# sourceMappingURL=chunk-2271a1ea.3208d8ed.js.map